<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, intial-scale=1, shrink-to-fit=no">

    <script src="https://d3js.org/d3.v5.js"></script>
    
</head>
    
<body>
    <style lang="scss">
        svg {
            overflow: visible;
        }
    </style>

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <h1>Views By Category</h1>
    <!-- Code Taken from https://www.tutorialsteacher.com/d3js/create-bar-chart-using-d3js on 2019-09-08 -->
    <svg class="svg" width="1000" height="400"></svg>

    <script type="text/javascript">
        var data = "{{categories}}";
        var idToCategory = "{{idToCategory}}";
        data = JSON.parse(data.replace(/\(/g,'[').replace(/\)/g,']'));
        idToCategory = JSON.parse(idToCategory.replace(/&#39;/g,'\"').replace(/ &amp;/g,','));
        console.log(idToCategory)

        var svg = d3.select("svg"), leftMargin = 200, topMargin = 100, width = svg.attr("width") - leftMargin, height = svg.attr("height") - topMargin;


        var xScale = d3.scaleLinear().range([0, width]),
            yScale = d3.scaleBand().range([height, 0]);

        var g = svg.append("g")
                .attr("transform", "translate(" + leftMargin / 2 + "," + topMargin / 2 + ")");

        yScale.domain(data.map(function(d) { return d[0]; }));
        xScale.domain([0, d3.max(data, function(d) { return d[1]; })]);

        g.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(xScale).ticks(10));

        g.append("g")
            .call(d3.axisLeft(yScale).tickFormat(function(d){
                return idToCategory[d];
            }))
            .append("text")
            .attr("y", 6)
            .attr("dy", "0.71em")
            .attr("text-anchor", "end")
            .text("value");

        g.selectAll(".bar")
            .data(data)
            .enter().append("rect")
            .attr("class", "bar")
            .attr("x", 0 )
            .attr("y", function(d) { return yScale(d[0]); })
            .attr("height", yScale.bandwidth() - 5)
            .attr("width", function(d) { return xScale(d[1]); });
    </script>


</body>